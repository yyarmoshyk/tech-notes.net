---
title: "Sed crib"
#permalink: /docs/unique-ips-from-apache-log.html
excerpt: "Many examples of using sed."
last_modified_at: 2018-04-16T00:00:00-00:00
toc: false
categories:
  - Bash
tags:
  - sed
redirect_from:
  - /sed-examples/
---

Sed is a streaming text editor in UNIX-like OS'es that allows to quickly edit contents of the commands outputs and edit files in place.

The standart syntax is the following
```bash
sed [options] commands [file name]
```

Next you can find a lot of examples of sed usage

Replace the word (root -> Admin):

```bash
sed 's/root/Admin/' file_name
```

This command will print the contents of the `file_name` into the `stdout` replacing `root` with `admin`
Please note that replacement will be applied only to the first occurrence.
In order to update all records - use key `g`
```bash
sed 's/root/Admin/g' file_name
```

Usually `sed` experssion consists of 2 parts devided with `/`. You define what you need to be updated on the left, and the new value on the right.
If you need to define multiple expressions then use `-e`
```bash
sed -e 's/root/Admin/g' -e 's/bash/sh/g' file_name
```

Word replacement in the lines that contain particular word (replace `root` with `Admin` in the lines that contain keyword `user`)
```bash
sed '/user/s/root/Admin/g' file_name
```

If you need to update file in place then use `-i`:

```bash
sed -i '/user/s/root/Admin/g' file_name
```

Delete 5th line:
```bash
sed -i '5d' file_name
```

In order to create the backup of the original file beforee replacement use `-i.bak`

```bash
sed -i.bak '5d' file_name
```

Remove the line that contains particular word (ex. `games`):
```bash
sed '/games/d' file_name
```
Remove all empty lines:
```bash
sed '/^$/d' file_name
```

Print the range of lines (in this example the lines lines between 1 and 5 will be printed)
```bash
sed -n '1,5p' file_name
```

## Modifying stdout
As I've mentioned before `sed` can be used to modify the output of any command
For example compare the output of the following command
```bash
fd -kh
```

and its' modified output:
```bash
df -kh |sed 's/%/000000/g'
```

## Special chars

You can use special chars:
* `^` - line beginning
* `$` - line end
* `.` - any single character

The complete set is unlimited. `Sed` works great with regular expressions.


The following command will update the lines that start with `user`

```bash
sed '/^user/s/root/Admin/g' file_name
```

The following command will update the lines with trailing `data`:

```bash
sed '/data$/s/root/Admin/g' file_name
```

If you need to use some special character in `sed` expresion then it needs to be escaped with `\`.
In the following expample the word `root`+space after it will be replaced by `Admin:`
```bash
sed 's/root\ /Admin:/g' file_name
```

В случае использования символа | (pipe) в качестве разделителя спецсимволы экранировать не нужно, но при этом регулярные выражения работать не будут
One can use `|` (pipe) or `:` as an expression separator. In this case you don't need to escape special chars but regular expressions will not work.
```bash
sed 's|root |Admin:|g' file_name
```
## Regular expressions
Remove all numbers from the output:
```bash
sed 's/[0-9][0-9]//g'
```

### Repeat the value:

```bash
sed 's/root/& &/g'
```

Check out the output of the following:
```bash
echo "123 abc" | sed 's/[0-9][0-9]*/&-&/'
```

Regular expression `"[0-9]*"` defines 0 or more numbers
Regular expression `"[0-9]+"` defines 1 or more numbers

If you need to use the first word from the string - define it by escaped number.
```bash
sed 's/\([a-z]*\).*/\1/'
```

Check this out:
```bash
echo "abcd qwer zxc 123"| sed 's/\([a-z]*\).*/\1/'
```

### Swap the numbers:
```bash
sed 's/\([a-z]*\) \([a-z]*\)/\2 \1/'
```

The space in the left side of the expression can be replaces by any other separator.

Two tests:
```bash
echo "abcd qwer zxc 123"| sed -r 's/([a-z]+) ([a-z]+)/\2 \1/'
```
and
```bash
echo "abcd_qwer_zxc_123"| sed -r 's/([a-z]+)_([a-z]+)/\2_\1/'
echo "abcd_qwer_zxc_123"| sed -r 's/([a-z]+)_([a-z]+)/\2 \1/'
```

### Replace the text between two words

```bash
sed -ure 's/word1.+?word2/word1\ замена\ word2/g' -i файл
```

## Using variables in sed expressions
Everybody use variables in bash scripts. Sometimes you need to use `sed` with the particular variable.
The easieast way is to use `"` (double quotes) to wrap sed expressions

```bash
sed "s/$var1/$var2/g"
```

However double quotes don't work if one of `$var1` or `$var2` contains special chars. The proper work arround is to exclude variables from wrap (pay attention to single quotes arround the variables:

```bash
sed 's/'"$var1"'/'"$var2"'/g'
```

Complete documentation can be read at [gnu.org](https://www.gnu.org/software/sed/manual/sed.html)
